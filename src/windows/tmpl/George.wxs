<?xml version="1.0" encoding="windows-1252"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

    <Product Name="George {{ version }}" Manufacturer="Andante AS" Version="{{ strict-version }}"
             Id="F2B60755-E287-4573-B9BF-3BDA7FDD69C1" UpgradeCode="92DB4AE3-F596-4FCA-8CB1-5E7B45A95340"
             Language="1033" Codepage="1252" >

        <Package Id="*" Keywords="Installer" Description="Andante's George {{ version }} installer"
                 Comments="George - Create. Learn. Think." Manufacturer="Andante AS"
                 InstallerVersion="200" Languages="1033" Compressed="yes" SummaryCodepage="1252"/>

        <Media Id="1" Cabinet="George.cab" EmbedCab="yes" DiskPrompt="CD-ROM #1" />
        <Property Id="DiskPrompt" Value="Andante's George {{ version }} Installation [1]" />

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="GEORGEDIR" Name="Andante">
                    <Directory Id="APPROOTDIR" Name="George {{ version }}" />
                </Directory>
            </Directory>
        </Directory>

        <DirectoryRef Id="APPROOTDIR">

            <Component Id="GeorgeBatComp" Guid="*">
                <File Id="GeorgeBatFile" Name="George.bat" DiskId="1" Source="{{ bat-file }}" KeyPath="yes">
                    <Shortcut Id="StartMenuGeorge" Name="George"
                              Directory="ProgramMenuDir" WorkingDirectory="APPROOTDIR" Icon="George.ico"
                              IconIndex="0" Advertise="yes" />
                    <Shortcut Id="DesktopGeorge" Name="George"
                              Directory="DesktopFolder" WorkingDirectory="APPROOTDIR" Icon="George.ico"
                              IconIndex="0" Advertise="yes" />
                </File>
            </Component>

            <Component Id="GeorgeCLIBatComp" Guid="*">
                <File Id="GeorgeCLIBatFile" Name="GeorgeCLI.bat" DiskId="1" Source="{{ bat-cli-file }}" KeyPath="yes" />
            </Component>

            <Directory Id="DeployableDir" Name="deployable" />

            <Directory Id="JreDir" Name="jre" />

            <Directory Id="ProgramMenuFolder" Name="Programs">
                <Directory Id="ProgramMenuDir" Name="Andante (George)">
                    <Component Id="ProgramMenuDir" Guid="67A812DA-C48B-4558-8E17-9CBE58B37F2C">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="" KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>

            <Directory Id="DesktopFolder" Name="Desktop" />

        </DirectoryRef>


        <Feature Id="MainProgram" Title="George {{ version }}" Description="The complete package."
                 AllowAdvertise="no" Level="1" ConfigurableDirectory="GEORGEDIR">
            <ComponentRef Id="GeorgeBatComp" />
            <ComponentRef Id="GeorgeCLIBatComp" />
            <ComponentGroupRef Id="DeployableGroup" />
            <ComponentGroupRef Id="JreGroup" />
            <ComponentRef Id="ProgramMenuDir" />
        </Feature>

        <!-- Define launch-when-finished action: -->
        <Property Id="WixShellExecTarget" Value="[#GeorgeBatFile]" />
        <CustomAction Id="LaunchGeorgeOnFinish" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />

        <!-- Define a checkbox for launch-when-finished: -->
        <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Start George after Setup" />

        <UI>
            <UIRef Id="WixUI_Minimal" />

            <!-- Trigger launch-when-finished action: -->
            <Publish Dialog="ExitDialog"
                     Control="Finish"
                     Event="DoAction"
                     Value="LaunchGeorgeOnFinish">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
        </UI>

        <!-- Customize installer: -->
        <WixVariable Id="WixUILicenseRtf" Value="epl-v10.rtf" />
        <WixVariable Id="WixUIBannerBmp" Value="src\windows\rsc\WixUIBannerBmp.bmp" />
        <WixVariable Id="WixUIDialogBmp" Value="src\windows\rsc\WixUIDialogBmp.bmp" />

        <!-- Set icon in Add/Remove Programs: -->
        <Property Id="ARPPRODUCTICON" Value="George.ico" />

        <Icon Id="George.ico" SourceFile="src\windows\rsc\George.ico" />

    </Product>
</Wix>